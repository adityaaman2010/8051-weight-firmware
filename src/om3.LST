C51 COMPILER V9.60.0.0   OM3                                                               08/28/2022 18:02:02 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE OM3
OBJECT MODULE PLACED IN om3.OBJ
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE om3.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include "REG_MG82FG5Bxx.H"
   2          #include "macro.h"
   3          #include "utility.h"
   4          #include "tm1640.h"
   5          
   6          
   7          void key_display(void);
   8          void Keypad_GPIO_Config(void);
   9          unsigned char scan_keypad(void);
  10          void key_sort(unsigned char);
  11          
  12          unsigned char hi_key_no, lo_key_no;
  13          unsigned char no_digits[] = {0xed,0xa0,0xd9,0xf8,0xb4,0x7c,0x7d,0xe0,0xfd,0xfc};  //0,1,2,3,4,5,6,7,8,9
  14          unsigned char digi_chk[] = {0x40,0xc0,0xe0,0xe8,0xe9,0xed,0xfd};
  15          unsigned char prc[] = {0x00, 0x4d,0x45, 0xd5, 0x00};
  16          unsigned char ver[] = { 0xed, 0xa2,0x00,0x45,0x5d, 0xad};
  17          unsigned char compny_name[] = { 0xb5, 0x5d,0x0d, 0x0d, 0xed, 0x10, 0x7c, 0x4d, 0xf5,0x0d,0x00,0x00,0x00,0x
             -00,0x00,0x00,0x00,0x00,0x00,0x00};
  18          unsigned char blank_UM[] = {0x00,0x00,0x00,0x00,0x00};
  19          unsigned char blank_L[] = { 0x00,0x00,0x00,0x00,0x00,0x00};
  20          unsigned char bat_digi[] = { 0x00,0x1d, 0xf5, 0xfd,0x00};
  21          unsigned char bat_voltg[] = { 0xb4,0xa2, 0xa0, 0x00,0x00};
  22          
  23          unsigned char adc_digi[8];
  24          
  25          
  26          void main(void)
  27          {   
  28   1          
  29   1          unsigned char key ;
  30   1          TM1640_GPIO_Config();
  31   1          Keypad_GPIO_Config();
  32   1          TM1640_Init(DSPTM1640_DIS);     //TM1640 initialization
  33   1          Delay_Some_Time(10 );
  34   1          
  35   1          TM1640_U_display(blank_UM);
  36   1          TM1640_M_display(blank_UM);
  37   1          TM1640_L_display(blank_L);
  38   1              
  39   1          TM1640_U_display(prc);
  40   1          ldelay();
  41   1            
  42   1          TM1640_L_display(ver);
  43   1          ldelay();
  44   1          
  45   1          TM1640_L_display(blank_L);
  46   1          TM1640_U_display(blank_UM);
  47   1          TM1640_M_display(blank_UM);
  48   1          ldelay();
  49   1          
  50   1          TM1640_UM_display(compny_name);
  51   1          ldelay();
  52   1          
  53   1          TM1640_digichk(digi_chk);
  54   1          ldelay();
C51 COMPILER V9.60.0.0   OM3                                                               08/28/2022 18:02:02 PAGE 2   

  55   1          
  56   1          TM1640_L_display(blank_L);
  57   1          TM1640_U_display(blank_UM);
  58   1          TM1640_M_display(blank_UM);
  59   1          ldelay();
  60   1          
  61   1          TM1640_U_display(bat_digi);
  62   1          TM1640_M_display(bat_voltg);
  63   1          ldelay();
  64   1        
  65   1      //    TM1640_L_display(blank_L);
  66   1      //    TM1640_U_display(blank_UM);
  67   1      //    TM1640_M_display(blank_UM);
  68   1      //    ldelay();
  69   1      
  70   1          while(1)
  71   1          {
  72   2            key = scan_keypad();
  73   2            Delay_Some_Time(10);
  74   2            if(key != 'A')
  75   2            {
  76   3              key_sort(key);
  77   3            }
  78   2            Delay_Some_Time(10);
  79   2            key_display();
  80   2            Delay_Some_Time(5000);
  81   2          }
  82   1          
  83   1      }
  84          
  85          void Keypad_GPIO_Config(void)
  86          {
  87   1          P1M0 = 0x1f;
  88   1          P22 = 1;
  89   1          P24 = 1;
  90   1          P26 = 1;
  91   1          P16 = 1;
  92   1          P15 = 1;
  93   1          P10 = 0;
  94   1          P11 = 0;
  95   1          P12 = 0;
  96   1          P13 = 0;
  97   1          P14 = 0;
  98   1          
  99   1      }
 100          
 101          void key_display(void)
 102          {
 103   1      
 104   1          TM1640Start();
 105   1          TM1640WriteByte(0x44); //Set the starting address
 106   1          TM1640Stop();
 107   1          TM1640Start();
 108   1          TM1640WriteByte(0xc2);
 109   1          TM1640WriteByte(lo_key_no);
 110   1          TM1640Stop();
 111   1          TM1640Start();
 112   1          TM1640WriteByte(0xc0);
 113   1          TM1640WriteByte(hi_key_no);
 114   1          TM1640Stop();
 115   1      
 116   1      }
C51 COMPILER V9.60.0.0   OM3                                                               08/28/2022 18:02:02 PAGE 3   

 117          
 118          unsigned char scan_keypad(void)
 119          {
 120   1        unsigned char i;
 121   1        unsigned char key_status = 'A';
 122   1        
 123   1        for(i = 0; i<5; i++)
 124   1        {
 125   2          if( i == 0)
 126   2          {
 127   3            KROW0 = 1;
 128   3            KROW1 = 0;
 129   3            KROW2 = 0;
 130   3            KROW3 = 0;
 131   3            KROW4 = 0;
 132   3            if(KCOL0 == 1)
 133   3            {
 134   4              while(KCOL0 == 1);
 135   4              key_status = 21;
 136   4            }
 137   3            if(KCOL1 == 1)
 138   3            {
 139   4              while(KCOL1 == 1);
 140   4              key_status = 24;
 141   4            }
 142   3            if(KCOL2 == 1)
 143   3            {
 144   4              while(KCOL2 == 1);
 145   4              key_status = 19;
 146   4            }
 147   3            if(KCOL3 == 1)
 148   3            {
 149   4              while(KCOL3 == 1);
 150   4              key_status = 14;
 151   4            }
 152   3            if(KCOL4 == 1)
 153   3            {
 154   4              while(KCOL4 == 1);
 155   4              key_status = 4;
 156   4            }
 157   3          }
 158   2          if( i == 1)
 159   2          {
 160   3            KROW0 = 0;
 161   3            KROW1 = 1;
 162   3            KROW2 = 0;
 163   3            KROW3 = 0;
 164   3            KROW4 = 0;
 165   3            if(KCOL0 == 1)
 166   3            {
 167   4              while(KCOL0 == 1);
 168   4              key_status = 18;
 169   4            }
 170   3            if(KCOL1 == 1)
 171   3            {
 172   4              while(KCOL1 == 1);
 173   4              key_status = 13;
 174   4            }
 175   3            if(KCOL2 == 1)
 176   3            {
 177   4              while(KCOL2 == 1);
 178   4              key_status = 22;
C51 COMPILER V9.60.0.0   OM3                                                               08/28/2022 18:02:02 PAGE 4   

 179   4            }
 180   3            if(KCOL3 == 1)
 181   3            {
 182   4              while(KCOL3 == 1);
 183   4              key_status = 17;
 184   4            }
 185   3            if(KCOL4 == 1)
 186   3            {
 187   4              while(KCOL4 == 1);
 188   4              key_status = 12;
 189   4            }
 190   3          }
 191   2          if( i == 2)
 192   2          {
 193   3            KROW0 = 0;
 194   3            KROW1 = 0;
 195   3            KROW2 = 1;
 196   3            KROW3 = 0;
 197   3            KROW4 = 0;
 198   3            if(KCOL0 == 1)
 199   3            {
 200   4              while(KCOL0 == 1);
 201   4              key_status = 10;
 202   4            }
 203   3            if(KCOL1 == 1)
 204   3            {
 205   4              while(KCOL1 == 1);
 206   4              key_status = 11;
 207   4            }
 208   3            if(KCOL2 == 1)
 209   3            {
 210   4              while(KCOL2 == 1);
 211   4              key_status = 9;
 212   4            }
 213   3            if(KCOL3 == 1)
 214   3            {
 215   4              while(KCOL3 == 1);
 216   4              key_status = 6;
 217   4            }
 218   3            if(KCOL4 == 1)
 219   3            {
 220   4              while(KCOL4 == 1);
 221   4              key_status = 3;
 222   4            }
 223   3          }
 224   2          if( i == 3)
 225   2          {
 226   3            KROW0 = 0;
 227   3            KROW1 = 0;
 228   3            KROW2 = 0;
 229   3            KROW3 = 1;
 230   3            KROW4 = 0;
 231   3            if(KCOL0 == 1)
 232   3            {
 233   4              while(KCOL0 == 1);
 234   4              key_status = 15;
 235   4            }
 236   3            if(KCOL1 == 1)
 237   3            {
 238   4              while(KCOL1 == 1);
 239   4              key_status = 16;
 240   4            }
C51 COMPILER V9.60.0.0   OM3                                                               08/28/2022 18:02:02 PAGE 5   

 241   3            if(KCOL2 == 1)
 242   3            {
 243   4              while(KCOL2 == 1);
 244   4              key_status = 8;
 245   4            }
 246   3            if(KCOL3 == 1)
 247   3            {
 248   4              while(KCOL3 == 1);
 249   4              key_status = 5;
 250   4            }
 251   3            if(KCOL4 == 1)
 252   3            {
 253   4              while(KCOL4 == 1);
 254   4              key_status = 2;
 255   4            }
 256   3          }
 257   2          if( i == 4)
 258   2          {
 259   3            KROW0 = 0;
 260   3            KROW1 = 0;
 261   3            KROW2 = 0;
 262   3            KROW3 = 0;
 263   3            KROW4 = 1;
 264   3            if(KCOL0 == 1)
 265   3            {
 266   4              while(KCOL0 == 1);
 267   4              key_status = 20;
 268   4            }
 269   3            if(KCOL1 == 1)
 270   3            {
 271   4              while(KCOL1 == 1);
 272   4              key_status = 0;
 273   4            }
 274   3            if(KCOL2 == 1)
 275   3            {
 276   4              while(KCOL2 == 1);
 277   4              key_status = 7;
 278   4            }
 279   3            if(KCOL3 == 1)
 280   3            {
 281   4              while(KCOL3 == 1);
 282   4              key_status = 4;
 283   4            }
 284   3            if(KCOL4 == 1)
 285   3            {
 286   4              while(KCOL4 == 1);
 287   4              key_status = 1;
 288   4            }
 289   3          }
 290   2        } 
 291   1        return key_status;
 292   1      }
 293          
 294          void key_sort(unsigned char temp_key)
 295          {
 296   1        if(temp_key <10)
 297   1        {
 298   2          hi_key_no = 0;
 299   2          lo_key_no = temp_key;
 300   2        }
 301   1        else
 302   1        {
C51 COMPILER V9.60.0.0   OM3                                                               08/28/2022 18:02:02 PAGE 6   

 303   2          hi_key_no = temp_key/10;
 304   2          lo_key_no = temp_key%10;
 305   2        }
 306   1        hi_key_no = no_digits[hi_key_no];
 307   1        lo_key_no = no_digits[lo_key_no];
 308   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    628    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     79       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
